# 프런트엔드 기술 보고서 v3 (user-front / admin-front)

## 1. 역할과 범위
- 이 프런트엔드는 두 가지 웹 화면으로 나뉩니다.
  - `user-front`: 일반 사용자가 예약을 생성·조회·취소하고, 번호판을 카메라로 찍어 자동 인식하는 화면.
  - `admin-front`: 관리자가 날짜별 예약 현황을 모니터링하고, 필요 시 예약을 삭제하는 화면.
- 공통 목표는 “복잡한 백엔드 로직을 최대한 숨기고, 사용자가 순서대로 따라가기만 해도 실수 없이 예약·관리할 수 있게 돕는 것”입니다.

## 2. 전체 구조
- 기술 스택
  - React 18 + TypeScript: 컴포넌트 기반 UI, 정적 타입으로 런타임 오류 감소.
  - Vite: 빠른 개발 서버와 빌드 시스템.
  - TailwindCSS: 클래스 기반 유틸리티 CSS로 일관된 디자인.
  - framer-motion: 화면 전환·요소 등장/퇴장 애니메이션.
  - lucide-react: SVG 아이콘 세트.
- API 연결 구조
  - 공통 상수 `API_BASE`를 사용해 백엔드(FastAPI)와 통신합니다.
  - 우선순위: `VITE_API_BASE` 환경변수 → 브라우저 현재 호스트 + 포트 8000.
  - 모든 HTTP 요청은 공통 오류 처리 함수 `extractError`를 거쳐, FastAPI가 반환하는 `detail`/`message`를 사용자가 이해할 수 있는 문장으로 보여줍니다.

## 3. 사용자 프런트(user-front) – 상세 흐름
### 3.1 주요 화면과 단계
1) 로그인 화면
   - 입력: 이메일, 비밀번호.
   - 처리: 백엔드 `/api/user/login` 호출 후 임시 토큰을 저장합니다(보안 목적보다는 “사용자 세션이 시작되었다”는 표시 역할).
   - 결과: 로그인 성공 시 “허브 메뉴(HubMenu)” 화면으로 이동합니다.

2) 허브 메뉴(HubMenu)
   - 카드 형태로 세 가지 진입점 제공:
     - 새 예약하기
     - 내 예약 보기
     - 요금 안내 보기(분당 단가 기준 단순 계산).
   - 이 단계에서 사용자는 다음 액션을 선택하며, 복잡한 옵션 없이 “무엇을 하고 싶은지”만 결정합니다.

3) 번호판 입력·검증(PlateVerificationPage)
   - 입력: 차량 번호판 문자열.
   - 프런트 단 검증
     - 한국 번호판 정규식을 사용해 기본 형식(숫자+글자+숫자 조합 등)을 확인합니다.
     - 공백 제거, 대/소문자 통일 등의 전처리를 수행합니다.
   - 백엔드 호출
     - `/api/plates/verify`: 선택한 날짜·시간·세션 기준으로 다른 예약과 겹치는지 확인.
     - `/api/reservations/my?plate=...`: 과거 예약 히스토리를 조회해 “이 번호로 이전에 예약한 적이 있는지” 보여줍니다.
   - 카메라 스캐너
     - `navigator.mediaDevices.getUserMedia`로 후면 카메라(가능하면 환경 카메라)를 열고, `<video>` 태그에 출력합니다.
     - “스냅” 버튼을 누르면 `canvas`에 프레임을 그린 뒤 JPEG로 인코딩하여 `/api/license-plates`로 전송합니다.
     - 응답으로 받은 `plate` 문자열을 번호 입력칸에 자동 채우고, 카메라 스트림을 안전하게 종료합니다(트랙 stop·video srcObject 해제).

4) 시간·세션 선택(SchedulePage)
   - 세션: 1~4번 충전 세션 중 하나 선택.
   - 날짜: 오늘 날짜 기준으로 -3일 ~ +10일 범위를 슬라이더/리스트 형태로 제공.
   - 시간:
     - 30분 단위 슬롯 배열(SLOTS)을 정의(예: 09:00, 09:30, …, 21:30).
     - 시작 시간과 총 사용 시간(30/60/90/120분)을 선택하면, 끝 시간이 자동 계산됩니다.
   - 가용성 시각화:
     - 여러 날짜에 대해 `/api/reservations/by-session` 호출.
     - 선택된 세션에 대해 각 예약의 `startTime~endTime`을 30분 단위로 쪼개 “점유 슬롯 집합”을 만듭니다.
     - 전체 슬롯 개수 대비 비어 있는 슬롯 비율로 색상(초록/노랑/빨강)을 정해 가용성 스트립을 그립니다.
     - 현재 선택된 날짜에 대해서는 일자별 점유 슬롯 상태를 기반으로, 선택 불가능한 시간대를 비활성화합니다.
   - 제약 조건(프런트에서 1차 필터):
     - 종료 시간이 22:00을 넘으면 자동으로 가장 늦게 가능한 시작 시간으로 조정.
     - 이미 점유된 슬롯은 선택 시 경고 메시지를 띄우고 다시 선택하게 합니다(최종 판단은 백엔드가 수행).

5) 예약 생성 및 결과(ReservationResult)
   - 예약 전 최종 검증
     - `/api/plates/verify` 재호출로 “해당 시간·세션·번호 조합이 여전히 유효한지” 확인(백엔드 기준).
   - 생성 요청
     - `/api/reservations`에 `sessionId, plate, date, startTime, endTime, contactEmail`을 JSON으로 전송.
   - 성공 화면
     - 예약 ID, 세션, 날짜, 시간, 예상 요금(분당 100원 가정)을 보여줍니다.
     - “내 예약 보기”, “다른 시간으로 변경”, “처음으로 돌아가기” 등 버튼을 제공합니다.

6) 내 예약 목록/상세(MyReservationsPage, ReservationDetailPage)
   - `/api/reservations/my?email=...`로 사용자의 모든 예약 불러오기.
   - 날짜+시간 순으로 정렬, 취소 가능 여부 표시(이미 지난 예약/취소된 예약은 버튼 비활성화).
   - 상세 화면에서는 예약 ID, 세션, 시간, 상태, 이메일을 보여주고, “취소” 버튼을 제공합니다.
   - 취소는 `DELETE /api/reservations/{id}?email=...` API로 수행하며, 성공 시 목록을 다시 갱신합니다.

### 3.2 에러 처리
- 공통 함수 `extractError`가 다음 순서로 메시지를 추출합니다.
  1. 응답 JSON의 `detail` 문자열.
  2. `detail` 배열의 첫 번째 요소의 `msg`.
  3. `message` 필드.
  4. 위가 없으면 응답 바디 텍스트, 최후에는 “Request failed (status …)” 텍스트.
- 이렇게 추출한 한글 메시지를 그대로 사용자에게 보여, 백엔드의 검증 에러를 이해하기 쉽도록 합니다.

## 4. 관리자 프런트(admin-front) – 상세 흐름
### 4.1 로그인 및 인증 유지
- 로그인 화면:
  - 입력: 관리자 이메일, 비밀번호.
  - 처리: `/api/admin/login` 호출 → 성공 시 `token`과 `admin.email` 수신.
  - 이 토큰을 메모리 상태에 저장하고, 이후 모든 관리자 API 호출 시 `Authorization: Bearer {token}` 헤더에 포함.
- 토큰이 유효하지 않으면(401 응답) 오류 메시지를 띄우고, 필요 시 다시 로그인하도록 유도합니다.

### 4.2 대시보드 화면(DashboardPage)
1) 조회 조건 영역
   - 날짜 선택: `<input type="date">`로 목표 날짜 지정.
   - 자동 새로고침 토글:
     - ON이면 15초마다 자동으로 `/api/admin/reservations/by-session` 재호출.
     - OFF이면 수동 “새로고침” 버튼으로만 호출.
   - 레이아웃 모드:
     - 카드 2열(Grid): 각 세션을 카드로 2열 배치.
     - 리스트(List): 1열 카드로 넓은 테이블을 보기 쉽게 표시.

2) KPI 카드
   - API 결과(`sessions`) 배열을 기준으로 다음을 계산합니다.
     - `totalRes`: 모든 세션의 예약 수 합.
     - `inProgress`: 상태가 `IN_PROGRESS`인 예약 수 합.
     - `utilization`: 슬롯 수 대비 예약 수를 기반으로 한 단순 점유율(예약당 1.7 슬롯 가중치 사용).
   - 각 값은 카드 컴포넌트에 아이콘과 함께 표시됩니다.

3) 세션 카드(SessionCard)
   - 상단 요약:
     - 세션 이름, 점유율, 진행 중 예약 수, 혼잡도 배지(여유/보통/혼잡).
   - 현재 진행 중 예약:
     - 현재 시간 기준으로 `startTime <= now < endTime`인 예약을 찾아 진행 상태를 표시합니다.
     - 전체 시간 대비 경과 비율을 ProgressBar로 표현하고, 남은 분 수를 표시합니다.
   - 다음 예약:
     - 아직 시작되지 않은 예약 중 가장 이른 시작 시간을 가진 하나를 “다음 예약”으로 표시.
   - 예약 테이블:
     - 시간, 차량 번호, 이메일, 예약 상태, “가상 차량 상태”(내부 해시 기반), 예약 ID, 삭제 버튼을 열로 가진 테이블.
     - 삭제 버튼:
       - 클릭 시 `window.confirm`으로 재확인 후 `DELETE /api/admin/reservations/{id}` 호출.
       - 성공 시 프런트 상태에서 해당 예약을 즉시 제거하여 화면이 최신 상태로 보이게 합니다.

### 4.3 레이아웃과 애니메이션
- `framer-motion`의 `motion.div`를 사용해 화면 단계·레이아웃 전환 시 부드러운 애니메이션을 제공합니다.
- Tailwind의 그리드/플렉스 클래스로 반응형 레이아웃을 구성하여, 넓은 화면에서는 2열 카드, 좁은 화면에서는 1열 리스트로 자연스럽게 전환됩니다.

## 5. 설계 상 강점과 한계
### 5.1 강점
- 사용자와 관리자의 역할을 물리적으로 다른 앱으로 분리하여, 코드와 UX가 단순합니다.
- API 오류가 그대로 사용자 메시지에 반영되어, 문제 원인을 빠르게 알 수 있습니다.
- 카메라 스캐너와 번호판 인식 흐름을 프런트에서 완성도 있게 다뤄 실제 체험이 자연스럽습니다.
- 자동 새로고침·가용성 스트립 등 운영 편의 기능이 풍부합니다.

### 5.2 한계
- 사용자 로그인 토큰은 “진짜 인증”이라기보다 세션 마커에 가깝기 때문에, 보안이 강하지 않습니다.
- 모바일 환경·접근성(A11y)에 대한 체계적인 검증이 부족합니다.
- 번들 최적화(코드 스플리팅 등)와 에러 로깅(Sentry 등)이 기본 포함되어 있지 않습니다.

## 6. 향후 개선 방향(요약)
- 인증/인가:
  - 사용자·관리자 모두 JWT/OAuth 기반 정식 인증 도입, 비밀번호 정책 및 실패 횟수 제한 적용.
- UX/접근성:
  - 모바일 뷰 최적화, 스크린리더 지원, 키보드 내비게이션 개선.
- 성능·운영:
  - 코드 스플리팅, 캐시 전략 도입, 빌드/배포 파이프라인 정리.
  - 오류 추적·성능 모니터링 도구를 연동하여 실시간 진단 가능하게 구성.

